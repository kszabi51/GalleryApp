<!-- Import Vue script -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.16/vue.min.js"></script>

<!-- HTML of the component -->
<div id="app" class="container">
    <div class="gallery">
        <!-- Title -->
        <h1>{{ title }} <small>Vue.js</small</h1>
        <!-- Pictures -->
        <div class="row">
            <div v-for="photo in photos" class="photo-frame" @click="showPhoto(photo.id)">
                <div class="photo" :style="{ backgroundImage: 'url(' + photo.urlThumbnail + ')' }"></div>
            </div>
        </div>
        <!-- Pager -->
        <div class="row">
            <div class="pager-frame">
                <ul class="pager-frame">
                    <li v-for="page in idxLastPage" class="page" :class="{ active: (idxCurrentPage+1) == page }" @click="paginate(page-1)">
                        <a href="#">{{ page }}</a>
                    </li>
                </ul>
            </div>
        </div>
        <div id="overlay" v-show="isShowPhoto" @click="isShowPhoto=false"></div>
        <div id="layout" v-show="isShowPhoto" @click="isShowPhoto=false">
            <img :src="showPhotoUrl" alt="">
        </div>
    </div>
</div>

<!-- JavaScript logic of the component -->
<script>
var allPhotos = getPhotos();

    vue = new Vue({
        el: '#app', // Range
        data: { //Data
            title: 'Gallery App',
            allPhotos: allPhotos,
            photos: [],
            photosPerPage: 12,
            idxLastPhoto: 0,
            idxCurrentPage: 0,
            idxLastPage: 0,
            isShowPhoto: false,
            showPhotoUrl: ""
        },
        mounted: function() { // Runs at Startup
            // initialize indexes
            this.idxLastPhoto = this.allPhotos.length;
            this.idxLastPage = Math.floor(this.allPhotos.length / this.photosPerPage);
            
            //show first page
            this.paginate(0);

            // If escape is pressed, close the picture
            document.addEventListener("keydown", e => {
                if(this.isShowPhoto && e.keyCode == 27)
                {
                    this.isShowPhoto = false;
                }
            });
        },
        methods: { // Accessible methods
            // Update arrays
            paginate: function(idxPage) {
                this.idxCurrentPage = idxPage;

                // Interval
                var idxStart = Math.floor(idxPage*this.photosPerPage);
                var idxEnd = idxStart+this.photosPerPage > this.idxLastPhoto ? this.idxLastPhoto : idxStart+this.photosPerPage;

                // Delete photos array's content
                this.photos.splice(0, this.photos.length)

                // rebuild visible photos
                for(var idx = idxStart; idx < idxEnd; idx++) {
                    this.photos.push(this.allPhotos[idx]);
                }
            },

            showPhoto: function(id) {
                var that = this;
                // id alapján a fotó objektumának megkeresése
                this.photos.forEach(function(photo) {
                    if (photo.id === id) {
                        that.showPhotoUrl = photo.urlPhoto; // a nagykép url-jének meghatározása
                        that.isShowPhoto = true;            // a nagykép megjelenítése
                        return;
                    }
                });
            }
        }
});

    // Returns the data of all the photos
    function getPhotos(){
        var pexelids = [
        3130385, 2739074, 2739074, 2739074, 2739074, 2739074, 2739074, 2739074, 2739074, 2832023, 2739074, 2832023,
        2739074, 2739074, 2832023,  2739074,  2739074, 2739074, 2832023, 2739074, 2739074, 3095293, 2739074, 2739074,
        2739074, 2739074, 2739074, 2739074, 3095293, 3125852,  2739074, 3095293, 2739074, 2739074, 2739074, 3125852
        ];

        var photos = [];
        pexelids.forEach(function(id,index) {
            photos.push({
                urlPhoto: 'https://images.pexels.com/photos/'+id+'/pexels-photo-'+id+'.jpeg?w=300&h=200&auto=compress&cs=tinysrgb',
                urlThumbnail: 'https://images.pexels.com/photos/'+id+'/pexels-photo-'+id+'.jpeg?w=1260&h=750&auto=compress&cs=tinysrgb',
                id: index
            });
        });

        return photos;
    };
</script>

<style>
@import url('https://fonts.googleapis.com/css?family=PT+Sans+Narrow');

body { font-family: 'PT Sans Narrow', sans-serif; }

.container {
  max-width: 1500px;
  margin: 10px auto;
  clear: both;
  text-align: center;
}

  .h1 { 
    font-size: 3em;
    color: #226;
}
  .small { 
      font-size: 1em;
       color: #888; 
  }

  .photo-frame {
    width: 310px;
    height: 210px;
    padding: 5px;
    border: 1px solid #eee;
    background-color: #fafafa;
    margin: 5px;
    float: left;
    cursor: pointer;   
  }
  .photo {
      width: 300px;
      height: 200px;
      border: 1px solid #aaa;
      padding-left: 5px;
      padding-top: 5px;
      overflow: hidden;
      background-position: top center;
      background-size: cover;
    }

div.row {  
    clear: both; 
}

ul.pager-frame {
  display: inline-block;
  clear: both;
  text-align: center;
  list-style-type: none;
}

li.page {
    width: 40px;
    border-radius: 50px 50px;
    border: 1px solid #888;
    float: left;
    margin-left: 20px;
    font-size: 2em;
}
    a:hover { 
        background-color: #ccc;
        cursor: pointer;  
    }
    a { 
        text-decoration: none;
        color: #222; 
    }
    a.active { 
        background-color: #ddd; 
    }

/* Darkening background */
#overlay {
  position: fixed;
  z-index: 10;
  left: 0px;
  top: 0px;
  width: 100%;
  height: 100%;
  text-align: center;
  background: rgba(0, 0, 0, 0.7);
  text-align: center;
}

/* Enlarged Photo is in this layer */
#layout {
  z-index: 11;
  position: absolute;
  top: 0;
  left: 0;
  width: 95%;
  margin-top: 50px;
  text-align: center;
}
  
#layout img {
    margin: 40px auto 0;
    max-width: 1260px;
    width: 100%;
    border: 1px solid #aaa;
    box-shadow: 0 0 10px black;
  }
}

</style>
